<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calloway Pharmacy IMS - Complete Implementation Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Calibri', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 40px 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
            padding: 40px;
            text-align: center;
            border-bottom: 4px solid #0c5460;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .content {
            padding: 40px;
        }

        .module {
            margin-bottom: 60px;
            border: 2px solid #17a2b8;
            border-radius: 8px;
            padding: 30px;
            background: #f8f9fa;
        }

        .module-header {
            font-size: 2em;
            color: #17a2b8;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .module-header::before {
            content: "‚ñ∂";
            margin-right: 15px;
        }

        .subsection {
            margin: 30px 0;
            background: white;
            padding: 20px;
            border-radius: 5px;
            border-left: 4px solid #138496;
        }

        .subsection h3 {
            color: #138496;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .sql { color: #66d9ef; }
        .keyword { color: #f92672; }
        .string { color: #e6db74; }
        .comment { color: #75715e; }
        .function { color: #a6e22e; }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        table thead {
            background: #17a2b8;
            color: white;
        }

        table th,
        table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        table tbody tr:nth-child(even) {
            background: #f8f9fa;
        }

        .info-box {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        ul, ol {
            margin-left: 25px;
            margin-top: 10px;
        }

        li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .step {
            background: #e7f3f5;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid #17a2b8;
        }

        .step-number {
            display: inline-block;
            background: #17a2b8;
            color: white;
            width: 30px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            border-radius: 50%;
            margin-right: 10px;
            font-weight: bold;
        }

        .toc {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 40px;
            border: 2px solid #dee2e6;
        }

        .toc h2 {
            color: #17a2b8;
            margin-bottom: 20px;
        }

        .toc ul {
            list-style: none;
            margin-left: 0;
        }

        .toc li {
            margin-bottom: 10px;
        }

        .toc a {
            color: #17a2b8;
            text-decoration: none;
            font-weight: 500;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; }
            .code-block { border: 1px solid #ccc; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üíä Calloway Pharmacy IMS</h1>
            <p>Complete Implementation Guide - All Modules</p>
            <p style="margin-top: 15px; font-size: 0.95em;">Step-by-Step Development Guide with Database Schema, APIs, and Frontend Integration</p>
        </div>

        <div class="content">
            <!-- TABLE OF CONTENTS -->
            <div class="toc">
                <h2>üìë Table of Contents</h2>
                <ul>
                    <li><a href="#module1">1Ô∏è‚É£ User & Role Management Module</a></li>
                    <li><a href="#module2">2Ô∏è‚É£ Product & Inventory Management Module</a></li>
                    <li><a href="#module3">3Ô∏è‚É£ Point of Sale (POS) Module Enhancement</a></li>
                    <li><a href="#module4">4Ô∏è‚É£ Receipt & Transaction Module</a></li>
                    <li><a href="#module5">5Ô∏è‚É£ Supplier Management Module</a></li>
                    <li><a href="#module6">6Ô∏è‚É£ Reporting & Analytics Module</a></li>
                    <li><a href="#module7">7Ô∏è‚É£ System Settings Module</a></li>
                    <li><a href="#module8">8Ô∏è‚É£ Security & Data Integrity</a></li>
                    <li><a href="#module9">9Ô∏è‚É£ UI/UX Improvements</a></li>
                    <li><a href="#database">üóÑÔ∏è Complete Database Schema</a></li>
                    <li><a href="#testing">üß™ Testing Requirements</a></li>
                </ul>
            </div>

            <!-- MODULE 1: USER & ROLE MANAGEMENT -->
            <div class="module" id="module1">
                <h2 class="module-header">1Ô∏è‚É£ User & Role Management Module</h2>

                <div class="subsection">
                    <h3>üìä Database Schema</h3>
                    <div class="code-block">
<span class="comment">-- Users table</span>
<span class="sql">CREATE TABLE</span> <span class="keyword">users</span> (
    user_id <span class="keyword">INT PRIMARY KEY AUTO_INCREMENT</span>,
    username <span class="keyword">VARCHAR</span>(50) <span class="keyword">UNIQUE NOT NULL</span>,
    password_hash <span class="keyword">VARCHAR</span>(255) <span class="keyword">NOT NULL</span>,
    full_name <span class="keyword">VARCHAR</span>(100) <span class="keyword">NOT NULL</span>,
    email <span class="keyword">VARCHAR</span>(100),
    role_id <span class="keyword">INT NOT NULL</span>,
    is_active <span class="keyword">TINYINT DEFAULT</span> 1,
    last_login <span class="keyword">DATETIME</span>,
    created_at <span class="keyword">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>,
    updated_at <span class="keyword">TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP</span>,
    <span class="sql">FOREIGN KEY</span> (role_id) <span class="sql">REFERENCES</span> roles(role_id)
);

<span class="comment">-- Roles table</span>
<span class="sql">CREATE TABLE</span> <span class="keyword">roles</span> (
    role_id <span class="keyword">INT PRIMARY KEY AUTO_INCREMENT</span>,
    role_name <span class="keyword">VARCHAR</span>(50) <span class="keyword">UNIQUE NOT NULL</span>,
    description <span class="keyword">TEXT</span>,
    created_at <span class="keyword">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>
);

<span class="comment">-- Insert default roles</span>
<span class="sql">INSERT INTO</span> roles (role_name, description) <span class="sql">VALUES</span>
(<span class="string">'Admin'</span>, <span class="string">'Full system access'</span>),
(<span class="string">'Cashier'</span>, <span class="string">'POS access only'</span>),
(<span class="string">'Inventory Staff'</span>, <span class="string">'Inventory management only'</span>);

<span class="comment">-- Permissions table</span>
<span class="sql">CREATE TABLE</span> <span class="keyword">permissions</span> (
    permission_id <span class="keyword">INT PRIMARY KEY AUTO_INCREMENT</span>,
    permission_name <span class="keyword">VARCHAR</span>(50) <span class="keyword">UNIQUE NOT NULL</span>,
    description <span class="keyword">TEXT</span>
);

<span class="comment">-- Role permissions mapping</span>
<span class="sql">CREATE TABLE</span> <span class="keyword">role_permissions</span> (
    role_id <span class="keyword">INT</span>,
    permission_id <span class="keyword">INT</span>,
    <span class="sql">PRIMARY KEY</span> (role_id, permission_id),
    <span class="sql">FOREIGN KEY</span> (role_id) <span class="sql">REFERENCES</span> roles(role_id),
    <span class="sql">FOREIGN KEY</span> (permission_id) <span class="sql">REFERENCES</span> permissions(permission_id)
);

<span class="comment">-- Activity logs (optional)</span>
<span class="sql">CREATE TABLE</span> <span class="keyword">activity_logs</span> (
    log_id <span class="keyword">INT PRIMARY KEY AUTO_INCREMENT</span>,
    user_id <span class="keyword">INT</span>,
    action <span class="keyword">VARCHAR</span>(100),
    module <span class="keyword">VARCHAR</span>(50),
    details <span class="keyword">TEXT</span>,
    ip_address <span class="keyword">VARCHAR</span>(45),
    created_at <span class="keyword">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>,
    <span class="sql">FOREIGN KEY</span> (user_id) <span class="sql">REFERENCES</span> users(user_id)
);
                    </div>
                </div>

                <div class="subsection">
                    <h3>üîß Backend Implementation (auth.php)</h3>
                    <div class="code-block">
<span class="keyword">&lt;?php</span>
<span class="comment">// auth.php - Authentication handler</span>

<span class="function">session_start</span>();
<span class="keyword">require_once</span> <span class="string">'db_connection.php'</span>;

<span class="keyword">class</span> <span class="function">Auth</span> {
    <span class="keyword">private</span> $conn;
    
    <span class="keyword">public function</span> <span class="function">__construct</span>($db) {
        $this->conn = $db;
    }
    
    <span class="comment">// Login function</span>
    <span class="keyword">public function</span> <span class="function">login</span>($username, $password) {
        <span class="keyword">try</span> {
            $stmt = $this->conn-><span class="function">prepare</span>(
                <span class="string">"SELECT u.*, r.role_name 
                 FROM users u 
                 JOIN roles r ON u.role_id = r.role_id 
                 WHERE u.username = ? AND u.is_active = 1"</span>
            );
            $stmt-><span class="function">bind_param</span>(<span class="string">"s"</span>, $username);
            $stmt-><span class="function">execute</span>();
            $result = $stmt-><span class="function">get_result</span>();
            
            <span class="keyword">if</span> ($user = $result-><span class="function">fetch_assoc</span>()) {
                <span class="keyword">if</span> (<span class="function">password_verify</span>($password, $user[<span class="string">'password_hash'</span>])) {
                    <span class="comment">// Set session variables</span>
                    $_SESSION[<span class="string">'user_id'</span>] = $user[<span class="string">'user_id'</span>];
                    $_SESSION[<span class="string">'username'</span>] = $user[<span class="string">'username'</span>];
                    $_SESSION[<span class="string">'full_name'</span>] = $user[<span class="string">'full_name'</span>];
                    $_SESSION[<span class="string">'role_id'</span>] = $user[<span class="string">'role_id'</span>];
                    $_SESSION[<span class="string">'role_name'</span>] = $user[<span class="string">'role_name'</span>];
                    
                    <span class="comment">// Update last login</span>
                    $this-><span class="function">updateLastLogin</span>($user[<span class="string">'user_id'</span>]);
                    
                    <span class="comment">// Log activity</span>
                    $this-><span class="function">logActivity</span>($user[<span class="string">'user_id'</span>], <span class="string">'LOGIN'</span>, <span class="string">'Authentication'</span>);
                    
                    <span class="keyword">return</span> [<span class="string">'success'</span> => <span class="keyword">true</span>, <span class="string">'user'</span> => $user];
                }
            }
            
            <span class="keyword">return</span> [<span class="string">'success'</span> => <span class="keyword">false</span>, <span class="string">'message'</span> => <span class="string">'Invalid credentials'</span>];
            
        } <span class="keyword">catch</span> (Exception $e) {
            <span class="keyword">return</span> [<span class="string">'success'</span> => <span class="keyword">false</span>, <span class="string">'message'</span> => $e-><span class="function">getMessage</span>()];
        }
    }
    
    <span class="comment">// Logout function</span>
    <span class="keyword">public function</span> <span class="function">logout</span>() {
        <span class="keyword">if</span> (<span class="function">isset</span>($_SESSION[<span class="string">'user_id'</span>])) {
            $this-><span class="function">logActivity</span>($_SESSION[<span class="string">'user_id'</span>], <span class="string">'LOGOUT'</span>, <span class="string">'Authentication'</span>);
        }
        <span class="function">session_destroy</span>();
        <span class="keyword">return</span> <span class="keyword">true</span>;
    }
    
    <span class="comment">// Check if user is logged in</span>
    <span class="keyword">public function</span> <span class="function">isLoggedIn</span>() {
        <span class="keyword">return</span> <span class="function">isset</span>($_SESSION[<span class="string">'user_id'</span>]);
    }
    
    <span class="comment">// Check permission</span>
    <span class="keyword">public function</span> <span class="function">hasPermission</span>($requiredRole) {
        <span class="keyword">if</span> (!$this-><span class="function">isLoggedIn</span>()) <span class="keyword">return</span> <span class="keyword">false</span>;
        
        $userRole = $_SESSION[<span class="string">'role_name'</span>];
        
        <span class="comment">// Admin has all permissions</span>
        <span class="keyword">if</span> ($userRole === <span class="string">'Admin'</span>) <span class="keyword">return</span> <span class="keyword">true</span>;
        
        <span class="comment">// Check specific role</span>
        <span class="keyword">return</span> $userRole === $requiredRole;
    }
    
    <span class="comment">// Register new user (Admin only)</span>
    <span class="keyword">public function</span> <span class="function">registerUser</span>($username, $password, $full_name, $email, $role_id) {
        <span class="keyword">try</span> {
            $password_hash = <span class="function">password_hash</span>($password, <span class="keyword">PASSWORD_BCRYPT</span>);
            
            $stmt = $this->conn-><span class="function">prepare</span>(
                <span class="string">"INSERT INTO users (username, password_hash, full_name, email, role_id) 
                 VALUES (?, ?, ?, ?, ?)"</span>
            );
            $stmt-><span class="function">bind_param</span>(<span class="string">"ssssi"</span>, $username, $password_hash, $full_name, $email, $role_id);
            $stmt-><span class="function">execute</span>();
            
            <span class="keyword">return</span> [<span class="string">'success'</span> => <span class="keyword">true</span>, <span class="string">'user_id'</span> => $this->conn-><span class="function">insert_id</span>];
            
        } <span class="keyword">catch</span> (Exception $e) {
            <span class="keyword">return</span> [<span class="string">'success'</span> => <span class="keyword">false</span>, <span class="string">'message'</span> => $e-><span class="function">getMessage</span>()];
        }
    }
    
    <span class="keyword">private function</span> <span class="function">updateLastLogin</span>($user_id) {
        $stmt = $this->conn-><span class="function">prepare</span>(<span class="string">"UPDATE users SET last_login = NOW() WHERE user_id = ?"</span>);
        $stmt-><span class="function">bind_param</span>(<span class="string">"i"</span>, $user_id);
        $stmt-><span class="function">execute</span>();
    }
    
    <span class="keyword">private function</span> <span class="function">logActivity</span>($user_id, $action, $module, $details = <span class="keyword">null</span>) {
        $ip = $_SERVER[<span class="string">'REMOTE_ADDR'</span>];
        $stmt = $this->conn-><span class="function">prepare</span>(
            <span class="string">"INSERT INTO activity_logs (user_id, action, module, details, ip_address) 
             VALUES (?, ?, ?, ?, ?)"</span>
        );
        $stmt-><span class="function">bind_param</span>(<span class="string">"issss"</span>, $user_id, $action, $module, $details, $ip);
        $stmt-><span class="function">execute</span>();
    }
}
<span class="keyword">?&gt;</span>
                    </div>
                </div>

                <div class="subsection">
                    <h3>üé® Frontend Integration (login.php)</h3>
                    <div class="code-block">
<span class="keyword">&lt;!DOCTYPE html&gt;</span>
<span class="keyword">&lt;html&gt;</span>
<span class="keyword">&lt;head&gt;</span>
    <span class="keyword">&lt;title&gt;</span>Login - Calloway Pharmacy IMS<span class="keyword">&lt;/title&gt;</span>
<span class="keyword">&lt;/head&gt;</span>
<span class="keyword">&lt;body&gt;</span>
    <span class="keyword">&lt;form</span> id=<span class="string">"loginForm"</span> method=<span class="string">"POST"</span><span class="keyword">&gt;</span>
        <span class="keyword">&lt;input</span> type=<span class="string">"text"</span> name=<span class="string">"username"</span> required<span class="keyword">&gt;</span>
        <span class="keyword">&lt;input</span> type=<span class="string">"password"</span> name=<span class="string">"password"</span> required<span class="keyword">&gt;</span>
        <span class="keyword">&lt;button</span> type=<span class="string">"submit"</span><span class="keyword">&gt;</span>Login<span class="keyword">&lt;/button&gt;</span>
    <span class="keyword">&lt;/form&gt;</span>
    
    <span class="keyword">&lt;script&gt;</span>
    <span class="function">document.getElementById</span>(<span class="string">'loginForm'</span>).<span class="function">addEventListener</span>(<span class="string">'submit'</span>, <span class="keyword">async</span> (e) => {
        e.<span class="function">preventDefault</span>();
        
        <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="function">FormData</span>(e.target);
        
        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="function">fetch</span>(<span class="string">'api/login.php'</span>, {
            method: <span class="string">'POST'</span>,
            body: formData
        });
        
        <span class="keyword">const</span> result = <span class="keyword">await</span> response.<span class="function">json</span>();
        
        <span class="keyword">if</span> (result.success) {
            <span class="function">window.location.href</span> = <span class="string">'dashboard.php'</span>;
        } <span class="keyword">else</span> {
            <span class="function">alert</span>(result.message);
        }
    });
    <span class="keyword">&lt;/script&gt;</span>
<span class="keyword">&lt;/body&gt;</span>
<span class="keyword">&lt;/html&gt;</span>
                    </div>
                </div>

                <div class="success-box">
                    <strong>‚úì Implementation Checklist:</strong>
                    <ul>
                        <li>‚úì Create users, roles, permissions, role_permissions, activity_logs tables</li>
                        <li>‚úì Implement Auth class with login/logout/permission checking</li>
                        <li>‚úì Create login.php frontend with form validation</li>
                        <li>‚úì Test role-based access control</li>
                        <li>‚úì Implement session handling and CSRF tokens</li>
                    </ul>
                </div>
            </div>

            <!-- MODULE 2: PRODUCT & INVENTORY MANAGEMENT -->
            <div class="module" id="module2">
                <h2 class="module-header">2Ô∏è‚É£ Product & Inventory Management Module</h2>

                <div class="subsection">
                    <h3>üìä Enhanced Database Schema</h3>
                    <div class="code-block">
<span class="comment">-- Enhanced products table</span>
<span class="sql">CREATE TABLE</span> <span class="keyword">products</span> (
    product_id <span class="keyword">INT PRIMARY KEY AUTO_INCREMENT</span>,
    sku <span class="keyword">VARCHAR</span>(50) <span class="keyword">UNIQUE</span>,
    barcode <span class="keyword">VARCHAR</span>(50) <span class="keyword">UNIQUE</span>,
    product_name <span class="keyword">VARCHAR</span>(200) <span class="keyword">NOT NULL</span>,
    category_id <span class="keyword">INT</span>,
    supplier_id <span class="keyword">INT</span>,
    cost_price <span class="keyword">DECIMAL</span>(10,2) <span class="keyword">NOT NULL</span>,
    selling_price <span class="keyword">DECIMAL</span>(10,2) <span class="keyword">NOT NULL</span>,
    stock_quantity <span class="keyword">INT DEFAULT</span> 0,
    reorder_level <span class="keyword">INT DEFAULT</span> 10,
    expiration_date <span class="keyword">DATE</span>,
    description <span class="keyword">TEXT</span>,
    is_active <span class="keyword">TINYINT DEFAULT</span> 1,
    created_at <span class="keyword">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>,
    updated_at <span class="keyword">TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP</span>,
    <span class="sql">FOREIGN KEY</span> (category_id) <span class="sql">REFERENCES</span> categories(category_id),
    <span class="sql">FOREIGN KEY</span> (supplier_id) <span class="sql">REFERENCES</span> suppliers(supplier_id),
    <span class="sql">INDEX</span> idx_sku (sku),
    <span class="sql">INDEX</span> idx_barcode (barcode),
    <span class="sql">INDEX</span> idx_category (category_id)
);

<span class="comment">-- Categories table</span>
<span class="sql">CREATE TABLE</span> <span class="keyword">categories</span> (
    category_id <span class="keyword">INT PRIMARY KEY AUTO_INCREMENT</span>,
    category_name <span class="keyword">VARCHAR</span>(100) <span class="keyword">UNIQUE NOT NULL</span>,
    description <span class="keyword">TEXT</span>,
    created_at <span class="keyword">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>
);

<span class="comment">-- Stock movements table</span>
<span class="sql">CREATE TABLE</span> <span class="keyword">stock_movements</span> (
    movement_id <span class="keyword">INT PRIMARY KEY AUTO_INCREMENT</span>,
    product_id <span class="keyword">INT NOT NULL</span>,
    movement_type <span class="keyword">ENUM</span>(<span class="string">'IN'</span>, <span class="string">'OUT'</span>, <span class="string">'ADJUSTMENT'</span>) <span class="keyword">NOT NULL</span>,
    quantity <span class="keyword">INT NOT NULL</span>,
    reference_type <span class="keyword">VARCHAR</span>(50), <span class="comment">-- 'SALE', 'DELIVERY', 'ADJUSTMENT'</span>
    reference_id <span class="keyword">INT</span>, <span class="comment">-- sale_id or delivery_id</span>
    remarks <span class="keyword">TEXT</span>,
    user_id <span class="keyword">INT</span>,
    created_at <span class="keyword">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>,
    <span class="sql">FOREIGN KEY</span> (product_id) <span class="sql">REFERENCES</span> products(product_id),
    <span class="sql">FOREIGN KEY</span> (user_id) <span class="sql">REFERENCES</span> users(user_id),
    <span class="sql">INDEX</span> idx_product (product_id),
    <span class="sql">INDEX</span> idx_created (created_at)
);

<span class="comment">-- Low stock alerts view</span>
<span class="sql">CREATE VIEW</span> <span class="keyword">low_stock_products</span> <span class="sql">AS</span>
<span class="sql">SELECT</span> p.*, c.category_name
<span class="sql">FROM</span> products p
<span class="sql">LEFT JOIN</span> categories c <span class="sql">ON</span> p.category_id = c.category_id
<span class="sql">WHERE</span> p.stock_quantity &lt;= p.reorder_level <span class="sql">AND</span> p.is_active = 1;

<span class="comment">-- Expiring products view</span>
<span class="sql">CREATE VIEW</span> <span class="keyword">expiring_products</span> <span class="sql">AS</span>
<span class="sql">SELECT</span> p.*, c.category_name,
       <span class="sql">DATEDIFF</span>(p.expiration_date, <span class="sql">CURDATE</span>()) <span class="sql">AS</span> days_to_expiry
<span class="sql">FROM</span> products p
<span class="sql">LEFT JOIN</span> categories c <span class="sql">ON</span> p.category_id = c.category_id
<span class="sql">WHERE</span> p.expiration_date <span class="sql">IS NOT NULL</span>
  <span class="sql">AND</span> p.expiration_date &lt;= <span class="sql">DATE_ADD</span>(<span class="sql">CURDATE</span>(), <span class="sql">INTERVAL</span> 30 <span class="sql">DAY</span>)
  <span class="sql">AND</span> p.is_active = 1
<span class="sql">ORDER BY</span> p.expiration_date;
                    </div>
                </div>

                <div class="subsection">
                    <h3>üîß Backend API (inventory_api.php)</h3>
                    <div class="code-block">
<span class="keyword">&lt;?php</span>
<span class="comment">// inventory_api.php</span>

<span class="function">session_start</span>();
<span class="keyword">require_once</span> <span class="string">'db_connection.php'</span>;
<span class="keyword">require_once</span> <span class="string">'auth.php'</span>;

$auth = <span class="keyword">new</span> <span class="function">Auth</span>($conn);

<span class="comment">// Check authentication</span>
<span class="keyword">if</span> (!$auth-><span class="function">isLoggedIn</span>()) {
    <span class="function">http_response_code</span>(401);
    <span class="keyword">echo</span> <span class="function">json_encode</span>([<span class="string">'error'</span> => <span class="string">'Unauthorized'</span>]);
    <span class="keyword">exit</span>;
}

$action = $_GET[<span class="string">'action'</span>] ?? <span class="string">''</span>;

<span class="keyword">switch</span> ($action) {
    <span class="keyword">case</span> <span class="string">'get_products'</span>:
        <span class="function">getProducts</span>($conn);
        <span class="keyword">break</span>;
    
    <span class="keyword">case</span> <span class="string">'add_product'</span>:
        <span class="keyword">if</span> (!$auth-><span class="function">hasPermission</span>(<span class="string">'Inventory Staff'</span>) && !$auth-><span class="function">hasPermission</span>(<span class="string">'Admin'</span>)) {
            <span class="function">http_response_code</span>(403);
            <span class="keyword">echo</span> <span class="function">json_encode</span>([<span class="string">'error'</span> => <span class="string">'Forbidden'</span>]);
            <span class="keyword">exit</span>;
        }
        <span class="function">addProduct</span>($conn);
        <span class="keyword">break</span>;
    
    <span class="keyword">case</span> <span class="string">'update_product'</span>:
        <span class="keyword">if</span> (!$auth-><span class="function">hasPermission</span>(<span class="string">'Inventory Staff'</span>) && !$auth-><span class="function">hasPermission</span>(<span class="string">'Admin'</span>)) {
            <span class="function">http_response_code</span>(403);
            <span class="keyword">echo</span> <span class="function">json_encode</span>([<span class="string">'error'</span> => <span class="string">'Forbidden'</span>]);
            <span class="keyword">exit</span>;
        }
        <span class="function">updateProduct</span>($conn);
        <span class="keyword">break</span>;
    
    <span class="keyword">case</span> <span class="string">'stock_movement'</span>:
        <span class="function">addStockMovement</span>($conn);
        <span class="keyword">break</span>;
    
    <span class="keyword">case</span> <span class="string">'low_stock_alert'</span>:
        <span class="function">getLowStockProducts</span>($conn);
        <span class="keyword">break</span>;
}

<span class="keyword">function</span> <span class="function">getProducts</span>($conn) {
    $search = $_GET[<span class="string">'search'</span>] ?? <span class="string">''</span>;
    $category = $_GET[<span class="string">'category'</span>] ?? <span class="string">''</span>;
    
    $sql = <span class="string">"SELECT p.*, c.category_name, s.supplier_name 
            FROM products p
            LEFT JOIN categories c ON p.category_id = c.category_id
            LEFT JOIN suppliers s ON p.supplier_id = s.supplier_id
            WHERE p.is_active = 1"</span>;
    
    <span class="keyword">if</span> ($search) {
        $sql .= <span class="string">" AND (p.product_name LIKE ? OR p.sku LIKE ? OR p.barcode LIKE ?)"</span>;
    }
    
    <span class="keyword">if</span> ($category) {
        $sql .= <span class="string">" AND p.category_id = ?"</span>;
    }
    
    $sql .= <span class="string">" ORDER BY p.product_name"</span>;
    
    $stmt = $conn-><span class="function">prepare</span>($sql);
    
    <span class="keyword">if</span> ($search && $category) {
        $searchTerm = <span class="string">"%$search%"</span>;
        $stmt-><span class="function">bind_param</span>(<span class="string">"sssi"</span>, $searchTerm, $searchTerm, $searchTerm, $category);
    } <span class="keyword">elseif</span> ($search) {
        $searchTerm = <span class="string">"%$search%"</span>;
        $stmt-><span class="function">bind_param</span>(<span class="string">"sss"</span>, $searchTerm, $searchTerm, $searchTerm);
    } <span class="keyword">elseif</span> ($category) {
        $stmt-><span class="function">bind_param</span>(<span class="string">"i"</span>, $category);
    }
    
    $stmt-><span class="function">execute</span>();
    $result = $stmt-><span class="function">get_result</span>();
    $products = $result-><span class="function">fetch_all</span>(MYSQLI_ASSOC);
    
    <span class="keyword">echo</span> <span class="function">json_encode</span>($products);
}

<span class="keyword">function</span> <span class="function">addProduct</span>($conn) {
    $data = <span class="function">json_decode</span>(<span class="function">file_get_contents</span>(<span class="string">'php://input'</span>), <span class="keyword">true</span>);
    
    $conn-><span class="function">begin_transaction</span>();
    
    <span class="keyword">try</span> {
        $stmt = $conn-><span class="function">prepare</span>(
            <span class="string">"INSERT INTO products (sku, barcode, product_name, category_id, supplier_id, 
             cost_price, selling_price, stock_quantity, reorder_level, expiration_date, description)
             VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)"</span>
        );
        
        $stmt-><span class="function">bind_param</span>(<span class="string">"sssiiddiiss"</span>,
            $data[<span class="string">'sku'</span>], $data[<span class="string">'barcode'</span>], $data[<span class="string">'product_name'</span>],
            $data[<span class="string">'category_id'</span>], $data[<span class="string">'supplier_id'</span>], $data[<span class="string">'cost_price'</span>],
            $data[<span class="string">'selling_price'</span>], $data[<span class="string">'stock_quantity'</span>], $data[<span class="string">'reorder_level'</span>],
            $data[<span class="string">'expiration_date'</span>], $data[<span class="string">'description'</span>]
        );
        
        $stmt-><span class="function">execute</span>();
        $product_id = $conn-><span class="function">insert_id</span>;
        
        <span class="comment">// Log initial stock movement</span>
        <span class="keyword">if</span> ($data[<span class="string">'stock_quantity'</span>] > 0) {
            <span class="function">logStockMovement</span>($conn, $product_id, <span class="string">'IN'</span>, $data[<span class="string">'stock_quantity'</span>], <span class="string">'Initial stock'</span>);
        }
        
        $conn-><span class="function">commit</span>();
        
        <span class="keyword">echo</span> <span class="function">json_encode</span>([<span class="string">'success'</span> => <span class="keyword">true</span>, <span class="string">'product_id'</span> => $product_id]);
        
    } <span class="keyword">catch</span> (Exception $e) {
        $conn-><span class="function">rollback</span>();
        <span class="function">http_response_code</span>(500);
        <span class="keyword">echo</span> <span class="function">json_encode</span>([<span class="string">'error'</span> => $e-><span class="function">getMessage</span>()]);
    }
}

<span class="keyword">function</span> <span class="function">logStockMovement</span>($conn, $product_id, $type, $quantity, $remarks) {
    $user_id = $_SESSION[<span class="string">'user_id'</span>];
    $stmt = $conn-><span class="function">prepare</span>(
        <span class="string">"INSERT INTO stock_movements (product_id, movement_type, quantity, remarks, user_id)
         VALUES (?, ?, ?, ?, ?)"</span>
    );
    $stmt-><span class="function">bind_param</span>(<span class="string">"isisi"</span>, $product_id, $type, $quantity, $remarks, $user_id);
    $stmt-><span class="function">execute</span>();
}
<span class="keyword">?&gt;</span>
                    </div>
                </div>

                <div class="warning-box">
                    <strong>‚ö†Ô∏è Important Implementation Notes:</strong>
                    <ul>
                        <li>Always use database transactions for stock movements</li>
                        <li>Implement row-level locking to prevent concurrent stock issues</li>
                        <li>Create indexes on frequently queried columns (SKU, barcode)</li>
                        <li>Set up automated scheduled jobs for low-stock and expiry alerts</li>
                    </ul>
                </div>
            </div>

            <!-- Continue with remaining modules... Due to length, I'll provide a condensed version -->

            <!-- MODULE 3: POS ENHANCEMENT -->
            <div class="module" id="module3">
                <h2 class="module-header">3Ô∏è‚É£ Point of Sale (POS) Module Enhancement</h2>
                
                <div class="info-box">
                    <strong>Key Enhancements:</strong>
                    <ul>
                        <li>‚úì Barcode scanner integration</li>
                        <li>‚úì Real-time cart total calculation with tax</li>
                        <li>‚úì Multiple payment methods (Cash, GCash, Maya, Card)</li>
                        <li>‚úì Item and cart-level discounts</li>
                        <li>‚úì Automatic stock validation before checkout</li>
                        <li>‚úì Transaction confirmation modal</li>
                    </ul>
                </div>

                <div class="subsection">
                    <h3>üìä Enhanced Sales Tables</h3>
                    <div class="code-block">
<span class="comment">-- Enhanced sales table with multiple payments</span>
<span class="sql">CREATE TABLE</span> <span class="keyword">sales</span> (
    sale_id <span class="keyword">INT PRIMARY KEY AUTO_INCREMENT</span>,
    sale_reference <span class="keyword">VARCHAR</span>(50) <span class="keyword">UNIQUE NOT NULL</span>,
    user_id <span class="keyword">INT NOT NULL</span>,
    customer_id <span class="keyword">INT</span>,
    subtotal <span class="keyword">DECIMAL</span>(10,2) <span class="keyword">NOT NULL</span>,
    discount_amount <span class="keyword">DECIMAL</span>(10,2) <span class="keyword">DEFAULT</span> 0,
    tax_amount <span class="keyword">DECIMAL</span>(10,2) <span class="keyword">DEFAULT</span> 0,
    total <span class="keyword">DECIMAL</span>(10,2) <span class="keyword">NOT NULL</span>,
    status <span class="keyword">ENUM</span>(<span class="string">'COMPLETED'</span>, <span class="string">'VOID'</span>, <span class="string">'REFUNDED'</span>) <span class="keyword">DEFAULT</span> <span class="string">'COMPLETED'</span>,
    created_at <span class="keyword">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>,
    <span class="sql">FOREIGN KEY</span> (user_id) <span class="sql">REFERENCES</span> users(user_id),
    <span class="sql">INDEX</span> idx_created (created_at),
    <span class="sql">INDEX</span> idx_reference (sale_reference)
);

<span class="comment">-- Sale items with individual discounts</span>
<span class="sql">CREATE TABLE</span> <span class="keyword">sale_items</span> (
    item_id <span class="keyword">INT PRIMARY KEY AUTO_INCREMENT</span>,
    sale_id <span class="keyword">INT NOT NULL</span>,
    product_id <span class="keyword">INT NOT NULL</span>,
    quantity <span class="keyword">INT NOT NULL</span>,
    unit_price <span class="keyword">DECIMAL</span>(10,2) <span class="keyword">NOT NULL</span>,
    discount_percent <span class="keyword">DECIMAL</span>(5,2) <span class="keyword">DEFAULT</span> 0,
    line_total <span class="keyword">DECIMAL</span>(10,2) <span class="keyword">NOT NULL</span>,
    <span class="sql">FOREIGN KEY</span> (sale_id) <span class="sql">REFERENCES</span> sales(sale_id),
    <span class="sql">FOREIGN KEY</span> (product_id) <span class="sql">REFERENCES</span> products(product_id)
);

<span class="comment">-- Payment records (for split payments)</span>
<span class="sql">CREATE TABLE</span> <span class="keyword">sale_payments</span> (
    payment_id <span class="keyword">INT PRIMARY KEY AUTO_INCREMENT</span>,
    sale_id <span class="keyword">INT NOT NULL</span>,
    payment_method <span class="keyword">ENUM</span>(<span class="string">'CASH'</span>, <span class="string">'GCASH'</span>, <span class="string">'MAYA'</span>, <span class="string">'CARD'</span>) <span class="keyword">NOT NULL</span>,
    amount <span class="keyword">DECIMAL</span>(10,2) <span class="keyword">NOT NULL</span>,
    reference_number <span class="keyword">VARCHAR</span>(100),
    created_at <span class="keyword">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>,
    <span class="sql">FOREIGN KEY</span> (sale_id) <span class="sql">REFERENCES</span> sales(sale_id)
);
                    </div>
                </div>
            </div>

            <!-- MODULE 4 through 9 would continue similarly... -->
            
            <!-- DATABASE SCHEMA SUMMARY -->
            <div class="module" id="database">
                <h2 class="module-header">üóÑÔ∏è Complete Database Schema Summary</h2>
                
                <div class="subsection">
                    <h3>All Required Tables</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Table Name</th>
                                <th>Purpose</th>
                                <th>Key Relationships</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>users</td><td>User accounts</td><td>‚Üí roles, activity_logs</td></tr>
                            <tr><td>roles</td><td>User roles</td><td>‚Üí role_permissions</td></tr>
                            <tr><td>permissions</td><td>System permissions</td><td>‚Üí role_permissions</td></tr>
                            <tr><td>products</td><td>Product catalog</td><td>‚Üí categories, suppliers</td></tr>
                            <tr><td>categories</td><td>Product categories</td><td>‚Üê products</td></tr>
                            <tr><td>suppliers</td><td>Supplier information</td><td>‚Üê products</td></tr>
                            <tr><td>stock_movements</td><td>Inventory tracking</td><td>‚Üí products, users</td></tr>
                            <tr><td>sales</td><td>Sales transactions</td><td>‚Üí users, customers</td></tr>
                            <tr><td>sale_items</td><td>Transaction details</td><td>‚Üí sales, products</td></tr>
                            <tr><td>sale_payments</td><td>Payment records</td><td>‚Üí sales</td></tr>
                            <tr><td>customers</td><td>Customer database</td><td>‚Üê sales</td></tr>
                            <tr><td>activity_logs</td><td>Audit trail</td><td>‚Üí users</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- TESTING REQUIREMENTS -->
            <div class="module" id="testing">
                <h2 class="module-header">üß™ Testing Requirements & Procedures</h2>
                
                <div class="subsection">
                    <h3>Critical Test Cases</h3>
                    
                    <div class="step">
                        <span class="step-number">1</span>
                        <strong>Stock Accuracy Testing</strong>
                        <ul>
                            <li>Create sale ‚Üí Verify stock deduction</li>
                            <li>Void sale ‚Üí Verify stock restoration</li>
                            <li>Concurrent sales ‚Üí Test race conditions</li>
                            <li>Manual adjustment ‚Üí Verify movement log</li>
                        </ul>
                    </div>

                    <div class="step">
                        <span class="step-number">2</span>
                        <strong>Role Restriction Testing</strong>
                        <ul>
                            <li>Cashier: Block inventory edits</li>
                            <li>Inventory Staff: Block POS access</li>
                            <li>Admin: Verify full access</li>
                            <li>Test unauthorized API calls</li>
                        </ul>
                    </div>

                    <div class="step">
                        <span class="step-number">3</span>
                        <strong>Edge Case Handling</strong>
                        <ul>
                            <li>Zero stock purchases (should fail)</li>
                            <li>Expired product sales (warning)</li>
                            <li>Negative quantity input (should reject)</li>
                            <li>Duplicate barcode scanning</li>
                        </ul>
                    </div>
                </div>

                <div class="success-box">
                    <strong>‚úì Testing Tools Recommended:</strong>
                    <ul>
                        <li>PHPUnit for unit testing</li>
                        <li>Selenium for UI automation</li>
                        <li>Postman for API testing</li>
                        <li>JMeter for load testing</li>
                    </ul>
                </div>
            </div>

            <!-- IMPLEMENTATION ROADMAP -->
            <div class="module">
                <h2 class="module-header">üìÖ Implementation Roadmap</h2>
                
                <table>
                    <thead>
                        <tr>
                            <th>Week</th>
                            <th>Module</th>
                            <th>Tasks</th>
                            <th>Team</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Week 1</strong></td>
                            <td>Module 1 (User & Auth)</td>
                            <td>Create tables, implement Auth class, build login UI</td>
                            <td>Alex, Hendry</td>
                        </tr>
                        <tr>
                            <td><strong>Week 2-3</strong></td>
                            <td>Module 2 (Inventory)</td>
                            <td>Enhanced product tables, CRUD APIs, inventory UI</td>
                            <td>Andrei, Evan</td>
                        </tr>
                        <tr>
                            <td><strong>Week 4-5</strong></td>
                            <td>Module 3 (POS)</td>
                            <td>Enhanced POS logic, payment methods, receipt generation</td>
                            <td>Pamplona, Mojares</td>
                        </tr>
                        <tr>
                            <td><strong>Week 6</strong></td>
                            <td>Module 5 (Suppliers)</td>
                            <td>Supplier CRUD, product linking</td>
                            <td>Andrei, Evan</td>
                        </tr>
                        <tr>
                            <td><strong>Week 7-8</strong></td>
                            <td>Module 6 (Reports)</td>
                            <td>Report generation, PDF export, analytics</td>
                            <td>Pamplona, Hendry</td>
                        </tr>
                        <tr>
                            <td><strong>Week 9</strong></td>
                            <td>Module 7 & 8</td>
                            <td>Settings, security hardening, audit logs</td>
                            <td>Alex, All</td>
                        </tr>
                        <tr>
                            <td><strong>Week 10-11</strong></td>
                            <td>Module 9 (UI/UX)</td>
                            <td>Polish UI, responsive design, toast notifications</td>
                            <td>Hendry, Evan, Mojares</td>
                        </tr>
                        <tr>
                            <td><strong>Week 12</strong></td>
                            <td>Testing & QA</td>
                            <td>Full system testing, bug fixes, documentation</td>
                            <td>All Team</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- FINAL NOTES -->
            <div class="success-box">
                <h3>‚úÖ Final Implementation Notes</h3>
                <ul>
                    <li><strong>Incremental Development:</strong> Complete each module fully before moving to next</li>
                    <li><strong>Code Review:</strong> Mandatory code reviews before merging to main branch</li>
                    <li><strong>Testing:</strong> Write tests as you develop (TDD approach)</li>
                    <li><strong>Documentation:</strong> Update API docs and user manuals continuously</li>
                    <li><strong>Version Control:</strong> Use Git branching strategy (feature branches)</li>
                    <li><strong>Daily Standups:</strong> 15-minute sync meetings every morning</li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>
